<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../paper-checkbox/paper-checkbox.html">
<link rel="import" href="../paper-progress/paper-progress.html">
<link rel="import" href="../paper-radio-button/paper-radio-button.html">
<link rel="import" href="../asq-base/asq-base.html">


<!--
`asq-option` is used as options in multi-choice questions.

##### Example
    <asq-option>Answer 1</asq-option>

@element asq-option
@group ASQ Elements
@blurb Element acting as options in multichoice questions.
@homepage http://github.com/ASQ_USI/asq-option
-->
<polymer-element name="asq-option">
  <template>
    <style>
      #progressBar{
        display: block;
        width: 100%;
      }

    </style>

    <!-- template for viewer -->
    <template if="{{role==roles.VIEWER}}">
      <div>
        <li>
        <core-label>
          <template  if="{{type=='radio'}}">
            <paper-radio-button id="option" name="{{name}}" ></paper-radio-button>
          </template>
          <template  if="{{type=='checkbox'}}">
            <paper-checkbox id="option" name="{{name}}" ></paper-checkbox>
          </template> 
          <content></content>
        </core-label>
        </li>
      </div>
    </template>

    <!-- template for presenter -->
    <template  if="{{role==roles.PRESENTER}}">
      <div>
        <li>
          <content></content> 
          <paper-progress id="progressBar"></paper-progress>
        </li>
      </div>
    </template> 

    <template  if="{{role==roles.TA}}">
      <div>
        <li>
          <content></content> 
        </li>
      </div>
    </template>    

  </template>
  <script>
    (function() {

      var p = {
        publish: {
          /**
           * The type of option, either "checkbox" or "radiobox". This value will be set by
           * an `asq-multi-choice` instance automatically. 
           * @attribute type
           * @type string
           * @default 'checkbox'
           */
          type: "checkbox",

          /**
           * This attribute denotes the state of a option, checked or not.
           * @attribute checked
           * @type boolean
           * @default false
           */
          checked: {value: false, reflect: true},

          /**
           * This attribute denotes the a option is disabled or endabled.
           * @attribute disabled
           * @type boolean
           * @default false
           */
          disabled: {value: false, reflect: true}
        },

        eventDelegates: {
          tap: 'tap'
        },
        

        /**
         * The `change` event is fired whenever the option is enabled and tapped.
         *
         * @event change
         * @param {Object} detail
         *   @param {boolean} detail.checked The new state of the option.
         */
        tap: function() {
          if (this.disabled) {
            return;
          }
          this.checked = ! this.checked;
          this.fire('change', {checked: this.checked});
        },


        /**
         * The `checkedChanged` event is fired ..... TODO
         *
         * @event checked-change
         * @param {Object} null
         *   
         */
        checkedChanged: function() {
          var tagName = (this.type == "checkbox")
           ? 'paper-checkbox'
           : 'paper-radio-button';

           var el = this.shadowRoot.querySelector(tagName);
           if( el ){
            el.checked = this.checked;
           }
          
          this.fire('checked-change');
        },


        created: function  () {

        },

        /**
         * The `submit` method will submit the answer to a wrapped 'asq-exercise' instance.
         * Only useful when the `role` is `viewer`.
         * 
         * @method submit
         */
        submit: function() {
          if ( this.role === this.roles.VIEWER ) {
            // console.log(this, this.role, this.shadowRoot.querySelector("#option").checked);
            return {uid: this.uid, value: this.$.option.checked};
          }
        },
       
      }

      ASQ.asqify(p);
      Polymer('asq-option', p);
    })()
    
  </script>
</polymer-element>
